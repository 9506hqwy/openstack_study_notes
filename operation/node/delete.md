# 削除

## ベアメタルインスタンスの削除

インスタンスを削除する。

```sh
openstack server delete bare00
```

cleaning が実行される。

```sh
openstack server list
```

```{note}
エラーが発生してインスタンスが削除できない。

Node e95249d5-0605-498c-9120-706ef05ec240 is locked by host controller.home.local, please retry after the current operation is completed.
```

```text
+--------------------------------------+------------+---------+-----------------------+-----------+----------+
| ID                                   | Name       | Status  | Networks              | Image     | Flavor   |
+--------------------------------------+------------+---------+-----------------------+-----------+----------+
| 5a1b1ee6-9b58-4093-9d33-17b4d038fa4d | bare00     | ERROR   |                       | cirros062 | b1.nano  |
+--------------------------------------+------------+---------+-----------------------+-----------+----------+
```

```sh
openstack baremetal node list
```

```text
+--------------------------------------+------+---------------+-------------+--------------------+-------------+
| UUID                                 | Name | Instance UUID | Power State | Provisioning State | Maintenance |
+--------------------------------------+------+---------------+-------------+--------------------+-------------+
| e95249d5-0605-498c-9120-706ef05ec240 | None | None          | power on    | clean wait         | False       |
+--------------------------------------+------+---------------+-------------+--------------------+-------------+
```

cleaning が完了するまで待つ。

```sh
openstack baremetal node list
```

```text
+--------------------------------------+------+---------------+-------------+--------------------+-------------+
| UUID                                 | Name | Instance UUID | Power State | Provisioning State | Maintenance |
+--------------------------------------+------+---------------+-------------+--------------------+-------------+
| e95249d5-0605-498c-9120-706ef05ec240 | None | None          | power off   | available          | False       |
+--------------------------------------+------+---------------+-------------+--------------------+-------------+
```

```sh
openstack allocation candidate list --resource CUSTOM_BAREMETAL=1
```

インスタンスを削除するまでリソースが回収されない。

```sh
openstack server delete 5a1b1ee6-9b58-4093-9d33-17b4d038fa4d
```

```sh
openstack allocation candidate list --resource CUSTOM_BAREMETAL=1
```

```text
+---+--------------------+--------------------------------------+-------------------------+--------------------------------------------------------------+
| # | allocation         | resource provider                    | inventory used/capacity | traits                                                       |
+---+--------------------+--------------------------------------+-------------------------+--------------------------------------------------------------+
| 1 | CUSTOM_BAREMETAL=1 | e95249d5-0605-498c-9120-706ef05ec240 | CUSTOM_BAREMETAL=0/1    | COMPUTE_IMAGE_TYPE_AMI,COMPUTE_IMAGE_TYPE_QCOW2,COMPUTE_NET_ |
|   |                    |                                      |                         | ATTACH_INTERFACE,COMPUTE_IMAGE_TYPE_RAW,COMPUTE_NODE         |
+---+--------------------+--------------------------------------+-------------------------+--------------------------------------------------------------+
```
